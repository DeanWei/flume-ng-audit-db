# target-agent.conf: agent which receives Oracle audit data

# Name the components on this agent
audit_agent.sources = avro_source
audit_agent.channels = es-audit-c es-listener-c es-metric-c es-alert-c hdfs-audit-c hdfs-listener-c hdfs-metric-c hdfs-alert-c
audit_agent.sinks = es-audit-s es-listener-s es-metric-s es-alert-s 
#hdfs-audit-s hdfs-listener-s hdfs-metric-s hdfs-alert-s

# Describe/configure the source
audit_agent.sources.avro_source.type = avro
audit_agent.sources.avro_source.bind = db-log-gateway.cern.ch
audit_agent.sources.avro_source.port = 4545
audit_agent.sources.avro_source.channels = es-audit-c es-listener-c es-metric-c es-alert-c hdfs-audit-c hdfs-listener-c hdfs-metric-c hdfs-alert-c
audit_agent.sources.avro_source.selector.type = multiplexing
audit_agent.sources.avro_source.selector.header = source_type
audit_agent.sources.avro_source.selector.mapping.audit = es-audit-c hdfs-audit-c
audit_agent.sources.avro_source.selector.mapping.listener = es-listener-c hdfs-listener-c
audit_agent.sources.avro_source.selector.mapping.metric = es-metric-c hdfs-metric-c
audit_agent.sources.avro_source.selector.mapping.alert = es-alert-c hdfs-alert-c
#audit_agent.sources.avro_source.selector.mapping.default = EVENTS ARE DISCARDED 

# HDFS channels
audit_agent.channels.hdfs-audit-c.type = memory
audit_agent.channels.hdfs-listener-c.type = memory
audit_agent.channels.hdfs-metric-c.type = memory
audit_agent.channels.hdfs-metric-c.capacity = 10000
audit_agent.channels.hdfs-alert-c.type = memory

# Elasticsearch channels
audit_agent.channels.es-audit-c.type = memory
audit_agent.channels.es-audit-c.capacity = 10000
audit_agent.channels.es-listener-c.type = memory
audit_agent.channels.es-listener-c.capacity = 10000
audit_agent.channels.es-metric-c.type = memory
audit_agent.channels.es-metric-c.capacity = 10000
audit_agent.channels.es-alert-c.type = memory
audit_agent.channels.es-alert-c.capacity = 10000

# HDFS sinks
audit_agent.sinks.hdfs-audit-s.type = org.apache.flume.sink.kite.DatasetSink
audit_agent.sinks.hdfs-audit-s.channel = hdfs-audit-c
audit_agent.sinks.hdfs-audit-s.kite.dataset.uri = dataset:hdfs://itrac925.cern.ch:8020/tmp/flume-events/audit/
audit_agent.sinks.hdfs-audit-s.kite.entityParser = ch.cern.db.flume.sink.kite.parser.JSONtoAvroParser$Builder

audit_agent.sinks.hdfs-listener-s.type = org.apache.flume.sink.kite.DatasetSink
audit_agent.sinks.hdfs-listener-s.channel = hdfs-listener-c
audit_agent.sinks.hdfs-listener-s.kite.dataset.uri = dataset:hdfs://itrac925.cern.ch:8020/tmp/flume-events/listener/
audit_agent.sinks.hdfs-listener-s.kite.entityParser = ch.cern.db.flume.sink.kite.parser.JSONtoAvroParser$Builder

audit_agent.sinks.hdfs-metric-s.type = org.apache.flume.sink.kite.DatasetSink
audit_agent.sinks.hdfs-metric-s.channel = hdfs-metric-c
audit_agent.sinks.hdfs-metric-s.kite.dataset.uri = dataset:hdfs://itrac925.cern.ch:8020/tmp/flume-events/metric/
audit_agent.sinks.hdfs-metric-s.kite.entityParser = ch.cern.db.flume.sink.kite.parser.JSONtoAvroParser$Builder

audit_agent.sinks.hdfs-alert-s.type = org.apache.flume.sink.kite.DatasetSink
audit_agent.sinks.hdfs-alert-s.channel = hdfs-alert-c
audit_agent.sinks.hdfs-alert-s.kite.dataset.uri = dataset:hdfs://itrac925.cern.ch:8020/tmp/flume-events/alert/
audit_agent.sinks.hdfs-alert-s.kite.entityParser = ch.cern.db.flume.sink.kite.parser.JSONtoAvroParser$Builder

# Elasticsearch sinks
audit_agent.sinks.es-audit-s.channel = es-audit-c
audit_agent.sinks.es-audit-s.type = com.frontier45.flume.sink.elasticsearch2.ElasticSearchSink
audit_agent.sinks.es-audit-s.batchSize = 100
audit_agent.sinks.es-audit-s.hostNames = itdb-es-dev.cern.ch:9200
audit_agent.sinks.es-audit-s.client = rest
audit_agent.sinks.es-audit-s.indexName = db-audit
audit_agent.sinks.es-audit-s.serializer = ch.cern.db.flume.sink.elasticsearch.serializer.JSONtoElasticSearchEventSerializer
audit_agent.sinks.es-audit-s.clusterName = itdb_dev

audit_agent.sinks.es-listener-s.channel = es-listener-c
audit_agent.sinks.es-listener-s.type = com.frontier45.flume.sink.elasticsearch2.ElasticSearchSink
audit_agent.sinks.es-listener-s.batchSize = 100
audit_agent.sinks.es-listener-s.hostNames = itdb-es-dev.cern.ch:9200
audit_agent.sinks.es-listener-s.client = rest
audit_agent.sinks.es-listener-s.indexName = db-listener
audit_agent.sinks.es-listener-s.serializer = ch.cern.db.flume.sink.elasticsearch.serializer.JSONtoElasticSearchEventSerializer
audit_agent.sinks.es-listener-s.clusterName = itdb_dev

audit_agent.sinks.es-metric-s.channel = es-metric-c
audit_agent.sinks.es-metric-s.type = com.frontier45.flume.sink.elasticsearch2.ElasticSearchSink
audit_agent.sinks.es-metric-s.batchSize = 100
audit_agent.sinks.es-metric-s.hostNames = itdb-es-dev.cern.ch:9200
audit_agent.sinks.es-metric-s.client = rest
audit_agent.sinks.es-metric-s.indexName = db-metric
audit_agent.sinks.es-metric-s.serializer = ch.cern.db.flume.sink.elasticsearch.serializer.JSONtoElasticSearchEventSerializer
audit_agent.sinks.es-metric-s.clusterName = itdb_dev

audit_agent.sinks.es-alert-s.channel = es-alert-c
audit_agent.sinks.es-alert-s.type = com.frontier45.flume.sink.elasticsearch2.ElasticSearchSink
audit_agent.sinks.es-alert-s.batchSize = 100
audit_agent.sinks.es-alert-s.hostNames = itdb-es-dev.cern.ch:9200
audit_agent.sinks.es-alert-s.client = rest
audit_agent.sinks.es-alert-s.indexName = db-alert
audit_agent.sinks.es-alert-s.serializer = ch.cern.db.flume.sink.elasticsearch.serializer.JSONtoElasticSearchEventSerializer
audit_agent.sinks.es-alert-s.clusterName = itdb_dev
