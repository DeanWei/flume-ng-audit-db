# gateway_agent_kafka_to_hdfs: Flume agent to transfer log and audit data of databases from Kafka to ElasticSearch

# Name the components on this agent
gateway_agent_kafka_to_hdfs.sources = kafka-source
gateway_agent_kafka_to_hdfs.channels = hdfs-metric-c hdfs-audit-11-c hdfs-audit-12-c hdfs-alert-c hdfs-listener-c
gateway_agent_kafka_to_hdfs.sinks = hdfs-metric-s hdfs-audit-11-s hdfs-audit-12-s hdfs-alert-s hdfs-listener-s

# Describe/configure the source
gateway_agent_kafka_to_hdfs.sources.kafka-source.type = ch.cern.db.flume.source.kafka.KafkaSource
gateway_agent_kafka_to_hdfs.sources.kafka-source.zookeeperConnect = habench001.cern.ch:2181
gateway_agent_kafka_to_hdfs.sources.kafka-source.groupId = db-flume-agent-kafka-to-es
gateway_agent_kafka_to_hdfs.sources.kafka-source.topic = itdb_db-audit-log
gateway_agent_kafka_to_hdfs.sources.kafka-source.useFlumeEventFormat = true
gateway_agent_kafka_to_hdfs.sources.kafka-source.channels = hdfs-metric-c hdfs-audit-11-c hdfs-audit-12-c hdfs-alert-c hdfs-listener-c
gateway_agent_kafka_to_hdfs.sources.kafka-source.selector.type = multiplexing
gateway_agent_kafka_to_hdfs.sources.kafka-source.selector.header = source_type
gateway_agent_kafka_to_hdfs.sources.kafka-source.selector.mapping.audit-11 = hdfs-audit-11-c
gateway_agent_kafka_to_hdfs.sources.kafka-source.selector.mapping.audit-12 = hdfs-audit-12-c
gateway_agent_kafka_to_hdfs.sources.kafka-source.selector.mapping.metric = hdfs-metric-c
gateway_agent_kafka_to_hdfs.sources.kafka-source.selector.mapping.alert = hdfs-alert-c
gateway_agent_kafka_to_hdfs.sources.kafka-source.selector.mapping.listener = hdfs-listener-c
#gateway_agent_kafka_to_hdfs.sources.kafka-source.selector.mapping.default = EVENTS ARE DISCARDED

# Memory channels
gateway_agent_kafka_to_hdfs.channels.hdfs-audit-11-c.type = memory
gateway_agent_kafka_to_hdfs.channels.hdfs-audit-11-c.capacity = 100000
gateway_agent_kafka_to_hdfs.channels.hdfs-audit-11-c.transactionCapacity = 100000
gateway_agent_kafka_to_hdfs.channels.hdfs-audit-12-c.type = memory
gateway_agent_kafka_to_hdfs.channels.hdfs-audit-12-c.capacity = 100000
gateway_agent_kafka_to_hdfs.channels.hdfs-audit-12-c.transactionCapacity = 100000
gateway_agent_kafka_to_hdfs.channels.hdfs-metric-c.type = memory
gateway_agent_kafka_to_hdfs.channels.hdfs-metric-c.capacity = 100000
gateway_agent_kafka_to_hdfs.channels.hdfs-metric-c.transactionCapacity = 100000
gateway_agent_kafka_to_hdfs.channels.hdfs-alert-c.type = memory
gateway_agent_kafka_to_hdfs.channels.hdfs-alert-c.capacity = 100000
gateway_agent_kafka_to_hdfs.channels.hdfs-alert-c.transactionCapacity = 100000
gateway_agent_kafka_to_hdfs.channels.hdfs-listener-c.type = memory
gateway_agent_kafka_to_hdfs.channels.hdfs-listener-c.capacity = 100000
gateway_agent_kafka_to_hdfs.channels.hdfs-listener-c.transactionCapacity = 100000

# HDFS sinks
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-11-s.type = org.apache.flume.sink.kite.DatasetSink
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-11-s.channel = hdfs-audit-11-c
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-11-s.kite.dataset.uri = dataset:hdfs://p01001532067275.cern.ch:8020/user/dblogs/testing/audit-11/
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-11-s.kite.entityParser = ch.cern.db.flume.sink.kite.parser.JSONtoAvroParser$Builder
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-11-s.kite.batchSize = 1000
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-11-s.kite.rollInterval = 300
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-11-s.auth.kerberosPrincipal = dblogs@CERN.CH
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-11-s.auth.kerberosKeytab = /etc/flume-ng/db-flume-agents-gateway/conf/dblogs.keytab

gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-12-s.type = org.apache.flume.sink.kite.DatasetSink
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-12-s.channel = hdfs-audit-12-c
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-12-s.kite.dataset.uri = dataset:hdfs://p01001532067275.cern.ch:8020/user/dblogs/testing/audit-12/
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-12-s.kite.entityParser = ch.cern.db.flume.sink.kite.parser.JSONtoAvroParser$Builder
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-12-s.kite.batchSize = 1000
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-12-s.kite.rollInterval = 300
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-12-s.auth.kerberosPrincipal = dblogs@CERN.CH
gateway_agent_kafka_to_hdfs.sinks.hdfs-audit-12-s.auth.kerberosKeytab = /etc/flume-ng/db-flume-agents-gateway/conf/dblogs.keytab

gateway_agent_kafka_to_hdfs.sinks.hdfs-metric-s.type = org.apache.flume.sink.kite.DatasetSink
gateway_agent_kafka_to_hdfs.sinks.hdfs-metric-s.channel = hdfs-metric-c
gateway_agent_kafka_to_hdfs.sinks.hdfs-metric-s.kite.dataset.uri = dataset:hdfs://p01001532067275.cern.ch:8020/user/dblogs/testing/metric/
gateway_agent_kafka_to_hdfs.sinks.hdfs-metric-s.kite.entityParser = ch.cern.db.flume.sink.kite.parser.JSONtoAvroParser$Builder
gateway_agent_kafka_to_hdfs.sinks.hdfs-metric-s.kite.batchSize = 1000
gateway_agent_kafka_to_hdfs.sinks.hdfs-metric-s.kite.rollInterval = 300
gateway_agent_kafka_to_hdfs.sinks.hdfs-metric-s.auth.kerberosPrincipal = dblogs@CERN.CH
gateway_agent_kafka_to_hdfs.sinks.hdfs-metric-s.auth.kerberosKeytab = /etc/flume-ng/db-flume-agents-gateway/conf/dblogs.keytab

gateway_agent_kafka_to_hdfs.sinks.hdfs-alert-s.type = org.apache.flume.sink.kite.DatasetSink
gateway_agent_kafka_to_hdfs.sinks.hdfs-alert-s.channel = hdfs-alert-c
gateway_agent_kafka_to_hdfs.sinks.hdfs-alert-s.kite.dataset.uri = dataset:hdfs://p01001532067275.cern.ch:8020/user/dblogs/testing/testing/alert/
gateway_agent_kafka_to_hdfs.sinks.hdfs-alert-s.kite.entityParser = ch.cern.db.flume.sink.kite.parser.JSONtoAvroParser$Builder
gateway_agent_kafka_to_hdfs.sinks.hdfs-alert-s.kite.batchSize = 1000
gateway_agent_kafka_to_hdfs.sinks.hdfs-alert-s.kite.rollInterval = 300
gateway_agent_kafka_to_hdfs.sinks.hdfs-alert-s.auth.kerberosPrincipal = dblogs@CERN.CH
gateway_agent_kafka_to_hdfs.sinks.hdfs-alert-s.auth.kerberosKeytab = /etc/flume-ng/db-flume-agents-gateway/conf/dblogs.keytab

gateway_agent_kafka_to_hdfs.sinks.hdfs-listener-s.type = org.apache.flume.sink.kite.DatasetSink
gateway_agent_kafka_to_hdfs.sinks.hdfs-listener-s.channel = hdfs-listener-c
gateway_agent_kafka_to_hdfs.sinks.hdfs-listener-s.kite.dataset.uri = dataset:hdfs://p01001532067275.cern.ch:8020/user/dblogs/testing/listener/
gateway_agent_kafka_to_hdfs.sinks.hdfs-listener-s.kite.entityParser = ch.cern.db.flume.sink.kite.parser.JSONtoAvroParser$Builder
gateway_agent_kafka_to_hdfs.sinks.hdfs-listener-s.kite.batchSize = 1000
gateway_agent_kafka_to_hdfs.sinks.hdfs-listener-s.kite.rollInterval = 300
gateway_agent_kafka_to_hdfs.sinks.hdfs-listener-s.auth.kerberosPrincipal = dblogs@CERN.CH
gateway_agent_kafka_to_hdfs.sinks.hdfs-listener-s.auth.kerberosKeytab = /etc/flume-ng/db-flume-agents-gateway/conf/dblogs.keytab