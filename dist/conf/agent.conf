# source-agent.conf: agent which loads Oracle audit data

# Name the components on this agent
audit_agent.sources = audit_source metric_source alert_source listener_source
audit_agent.channels = mem_channel
audit_agent.sinks = avro_sink

# Describe/configure the source
audit_agent.sources.audit_source.type = ch.cern.db.flume.source.JDBCSource
audit_agent.sources.audit_source.channels = mem_channel
audit_agent.sources.audit_source.batch.size = 1000
audit_agent.sources.audit_source.batch.minimumTime = 60000
audit_agent.sources.audit_source.reader.table = UNIFIED_AUDIT_TRAIL
audit_agent.sources.audit_source.reader.table.columnToCommit = EVENT_TIMESTAMP
audit_agent.sources.audit_source.reader.committingFile = /var/lib/flume-ng-audit-db/committed_value_audit.backup
audit_agent.sources.audit_source.duplicatedEventsProcessor.path = /var/lib/flume-ng-audit-db/last_events_audit.hash_list
audit_agent.sources.audit_source.interceptors = addhostgroup  addproducer
audit_agent.sources.audit_source.interceptors.addhostgroup.type = static
audit_agent.sources.audit_source.interceptors.addhostgroup.key = toplevel_hostgroup
audit_agent.sources.audit_source.interceptors.addhostgroup.value = audit
audit_agent.sources.audit_source.interceptors.addproducer.type = static
audit_agent.sources.audit_source.interceptors.addproducer.key = producer
audit_agent.sources.audit_source.interceptors.addproducer.value = it-db   

audit_agent.sources.metric_source.type = ch.cern.db.flume.source.JDBCSource
audit_agent.sources.metric_source.channels = mem_channel
audit_agent.sources.metric_source.batch.size = 1000
audit_agent.sources.metric_source.batch.minimumTime = 60000
audit_agent.sources.metric_source.reader.query = select begin_time, end_time, metric_name, value from v$sysmetric_history where metric_id in (2092,2093,2100,2124) and group_id=2
audit_agent.sources.metric_source.reader.committingFile = /var/lib/flume-ng-audit-db/committed_value_metric.backup
audit_agent.sources.metric_source.duplicatedEventsProcessor.path = /var/lib/flume-ng-audit-db/last_events_metric.hash_list 
audit_agent.sources.metric_source.interceptors = addhostgroup  addproducer
audit_agent.sources.metric_source.interceptors.addhostgroup.type = static
audit_agent.sources.metric_source.interceptors.addhostgroup.key = toplevel_hostgroup
audit_agent.sources.metric_source.interceptors.addhostgroup.value = metrics
audit_agent.sources.metric_source.interceptors.addproducer.type = static
audit_agent.sources.metric_source.interceptors.addproducer.key = producer
audit_agent.sources.metric_source.interceptors.addproducer.value = it-db   

audit_agent.sources.alert_source.type = ch.cern.db.flume.source.JDBCSource
audit_agent.sources.alert_source.channels = mem_channel
audit_agent.sources.alert_source.batch.size = 1000
audit_agent.sources.alert_source.batch.minimumTime = 300000
audit_agent.sources.alert_source.reader.table = X$DBGALERTEXT
audit_agent.sources.alert_source.reader.table.columnToCommit = ORIGINATING_TIMESTAMP
audit_agent.sources.alert_source.reader.committingFile = /var/lib/flume-ng-audit-db/committed_value_alert.backup
audit_agent.sources.alert_source.duplicatedEventsProcessor.path = /var/lib/flume-ng-audit-db/last_events_alert.hash_list
audit_agent.sources.alert_source.interceptors = addhostgroup  addproducer
audit_agent.sources.alert_source.interceptors.addhostgroup.type = static
audit_agent.sources.alert_source.interceptors.addhostgroup.key = toplevel_hostgroup
audit_agent.sources.alert_source.interceptors.addhostgroup.value = alert
audit_agent.sources.alert_source.interceptors.addproducer.type = static
audit_agent.sources.alert_source.interceptors.addproducer.key = producer
audit_agent.sources.alert_source.interceptors.addproducer.value = it-db   

audit_agent.sources.listener_source.type = ch.cern.db.flume.source.JDBCSource
audit_agent.sources.listener_source.channels = mem_channel
audit_agent.sources.listener_source.batch.size = 1000
audit_agent.sources.listener_source.batch.minimumTime = 60000
audit_agent.sources.listener_source.reader.query = select * from X$DBGDIREXT where logical_file like 'listener%' [and MODIFY_TIME >= TIMESTAMP ':committed_value'] order by MODIFY_TIME
audit_agent.sources.listener_source.reader.table.columnToCommit = MODIFY_TIME
audit_agent.sources.listener_source.reader.committingFile = /var/lib/flume-ng-audit-db/committed_value_listener.backup
audit_agent.sources.listener_source.duplicatedEventsProcessor.path = /var/lib/flume-ng-audit-db/last_events_listener.hash_list
audit_agent.sources.listener_source.interceptors = addhostgroup  addproducer
audit_agent.sources.listener_source.interceptors.addhostgroup.type = static
audit_agent.sources.listener_source.interceptors.addhostgroup.key = toplevel_hostgroup
audit_agent.sources.listener_source.interceptors.addhostgroup.value = tnslsnr
audit_agent.sources.listener_source.interceptors.addproducer.type = static
audit_agent.sources.listener_source.interceptors.addproducer.key = producer
audit_agent.sources.listener_source.interceptors.addproducer.value = it-db 

# Use a channel which buffers events in memory
audit_agent.channels.mem_channel.type = memory
audit_agent.channels.mem_channel.capacity = 10000
audit_agent.channels.mem_channel.transactionCapacity = 1000

# Describe the sink
audit_agent.sinks.avro_sink.type = avro
audit_agent.sinks.avro_sink.channel = mem_channel
audit_agent.sinks.avro_sink.hostname = flume-gw-dev.cern.ch
audit_agent.sinks.avro_sink.port = 11000
